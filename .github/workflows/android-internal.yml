name: ü§ñ Android CI/CD - Internal Testing

on:
  push:
    branches: [develop]
  workflow_dispatch:

jobs:
  build-android-internal:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
      # ... tus pasos anteriores hasta compilar y verificar el AAB ...

      - name: üìÑ Decodificar service-account.json
        run: |
          echo "${{ secrets.SERVICE_ACCOUNT_JSON_BASE64 }}" | base64 --decode > android/service-account.json

      - name: üìÇ Ver contenido de service-account.json (debug)
        run: |
          echo "=== START service-account.json ==="
          cat android/service-account.json || echo "(file not found)"
          echo "=== END service-account.json ==="

      - name: ‚úÖ Validar JSON
        run: |
          if ! jq empty android/service-account.json; then
            echo "‚ùå JSON inv√°lido o truncado"; exit 1;
          fi

      - name: üöÄ Subir a Google Play Console - INTERNAL
        uses: r0adkll/upload-google-play@v1
        with:
          serviceAccountJson: android/service-account.json
          packageName: com.teranov.zentiapp
          releaseFiles: ${{ github.workspace }}/android/app/build/outputs/bundle/release/app-release.aab
          track: internal
